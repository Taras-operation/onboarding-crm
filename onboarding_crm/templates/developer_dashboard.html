<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ö–∞–±—ñ–Ω–µ—Ç –†–æ–∑—Ä–æ–±–Ω–∏–∫–∞</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="mb-4">–ö–∞–±—ñ–Ω–µ—Ç –†–æ–∑—Ä–æ–±–Ω–∏–∫–∞</h2>

  <a href="{{ url_for('main.logout') }}" class="btn btn-outline-primary mb-4">–í–∏–π—Ç–∏</a>

  <!-- üîΩ –î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
  <div class="card mb-4">
    <div class="card-header fw-bold">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</div>
    <div class="card-body">
      <form action="{{ url_for('main.developer_dashboard') }}" method="POST">
        <div class="row g-3">
          <div class="col-md-4">
            <input name="tg_nick" placeholder="TG –Ω—ñ–∫" class="form-control" required>
          </div>
          <div class="col-md-4">
            <select name="role" class="form-select" required>
              <option disabled selected>üîΩ–û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å</option>
              <option value="mentor">–ú–µ–Ω—Ç–æ—Ä</option>
              <option value="teamlead">–¢—ñ–º–ª—ñ–¥</option>
              <option value="head">Head</option>
              <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
            </select>
          </div>
          <div class="col-md-4">
            <input name="department" placeholder="–í—ñ–¥–¥—ñ–ª" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="position" class="form-label">–ü–æ—Å–∞–¥–∞</label>
            <input type="text" name="position" id="position" required class="form-control">
          </div>
          <div class="col-md-4">
            <input name="username" placeholder="–õ–æ–≥—ñ–Ω" class="form-control" required>
          </div>
          <div class="col-md-4">
            <input name="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="form-control" required>
          </div>

          <!-- üîÅ –¢—ñ–º–ª—ñ–¥ –¥–ª—è –º–µ–Ω—Ç–æ—Ä–∞ -->
          <div class="col-md-4" id="teamlead-select" style="display: none;">
            <label for="teamlead_id" class="form-label">–¢—ñ–º–ª—ñ–¥</label>
            <select name="teamlead_id" id="teamlead_id" class="form-select">
              <option value="">–û–±–µ—Ä—ñ—Ç—å –¢–õ</option>
              {% for tl in teamleads %}
                <option value="{{ tl.id }}">{{ tl.tg_nick }} ({{ tl.department }})</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-success mt-3">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      </form>
    </div>
  </div>

  <!-- üìã –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ -->
  <div class="card mt-4">
    <div class="card-header fw-bold">–£—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</div>
    <div class="card-body">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>TG –Ω—ñ–∫</th>
            <th>–õ–æ–≥—ñ–Ω</th>
            <th>–í—ñ–¥–¥—ñ–ª</th>
            <th>–†–æ–ª—å</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î—ñ—è</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <tr id="user-row-{{ user.id }}">
              <td>{{ user.id }}</td>
              <td>{{ user.tg_nick }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.department }}</td>
              <td>{{ user.role }}</td>
              <td>{{ user.onboarding_status or '‚Äî' }}</td>
              <td>
                {% if user.role != 'developer' %}
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteUser({{ user.id }})">üóëÔ∏è</button>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- JS -->
<script>
  function deleteUser(userId) {
    if (!confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?")) return;

    fetch(`/onboarding/user/delete/${userId}`, {
      method: 'DELETE'
    }).then(res => {
      if (res.ok) {
        document.getElementById(`user-row-${userId}`)?.remove();
      } else {
        alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞");
      }
    });
  }

  // üîÅ –ü–æ–∫–∞–∑–∞—Ç–∏ –¢–õ –ª–∏—à–µ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ "mentor"
  document.querySelector('select[name="role"]').addEventListener('change', function () {
    const selectedRole = this.value;
    const teamleadSelect = document.getElementById('teamlead-select');

    if (selectedRole === 'mentor') {
      teamleadSelect.style.display = 'block';
      document.getElementById('teamlead_id').required = true;
    } else {
      teamleadSelect.style.display = 'none';
      document.getElementById('teamlead_id').required = false;
    }
  });
</script>

</body>
</html>