{% extends "base.html" %}
{% block title %}–ê—Ä—Ö—ñ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤{% endblock %}

{% block content %}
<div class="container mx-auto p-8">
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
      üì¶ –ê—Ä—Ö—ñ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤
    </h1>
    <a href="{{ url_for('main.managers_list') }}" 
       class="btn btn-outline btn-sm hover:btn-primary transition-all">
       ‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É
    </a>
  </div>

  {% if archived_managers %}
    <div class="bg-white shadow-lg rounded-2xl overflow-hidden">
      <table class="table w-full">
        <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
          <tr>
            <th class="py-3 px-4 text-left">#</th>
            <th class="py-3 px-4 text-left">Telegram</th>
            <th class="py-3 px-4 text-left">–ü–æ—Å–∞–¥–∞</th>
            <th class="py-3 px-4 text-left">–í—ñ–¥–¥—ñ–ª</th>
            <th class="py-3 px-4 text-left">–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç—É</th>
            <th class="py-3 px-4 text-left">–ü—Ä–æ–≥—Ä–µ—Å</th>
            <th class="py-3 px-4 text-left">–§—ñ–¥–±–µ–∫</th>
            <th class="py-3 px-4 text-left">–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody class="text-gray-700">
          {% for pair in archived_managers %}
            {% set manager = pair[0] %}
            {% set instance = pair[1] %}
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="py-3 px-4 font-medium text-gray-600">{{ loop.index }}</td>
              <td class="py-3 px-4 text-blue-600 font-semibold">@{{ manager.username }}</td>
              <td class="py-3 px-4">{{ manager.position or '‚Äî' }}</td>
              <td class="py-3 px-4">{{ manager.department or '‚Äî' }}</td>
              <td class="py-3 px-4">
                {{ instance.created_at.strftime("%d.%m.%Y") if instance.created_at else '‚Äî' }}
              </td>
              <td class="py-3 px-4">
                {{ instance.onboarding_step }}/
                {{ instance.structure['blocks'] | length if instance.structure is mapping and 'blocks' in instance.structure else instance.structure | length }}
              </td>
              <td class="py-3 px-4">
                {% if instance.final_decision == 'approved' %}
                  <span class="badge badge-success gap-1">‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ</span>
                {% elif instance.final_decision == 'rejected' %}
                  <span class="badge badge-error gap-1">‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ</span>
                {% elif instance.final_decision == 'needs_revision' %}
                  <span class="badge badge-warning gap-1">‚úçÔ∏è –î–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è</span>
                {% else %}
                  <span class="badge badge-neutral gap-1">‚Äî</span>
                {% endif %}
              </td>
              <td class="py-3 px-4">
                <a href="{{ url_for('main.manager_results', manager_id=manager.id, onboarding_id=instance.id) }}" 
                   class="btn btn-outline btn-xs hover:btn-primary transition-all">
                   –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="flex flex-col items-center justify-center py-12 text-gray-500">
      <p class="text-lg font-medium">–ü–æ–∫–∏ —â–æ –∞—Ä—Ö—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π.</p>
      <p class="text-sm">–ö–æ–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–µ—Ä—à—É—î –æ–Ω–±–æ—Ä–¥–∏–Ω–≥, –π–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑‚Äô—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç.</p>
    </div>
  {% endif %}
</div>
{% endblock %}