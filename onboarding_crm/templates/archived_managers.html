{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-6">
  <h1 class="text-3xl font-bold mb-6">üì¶ –ê—Ä—Ö—ñ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤</h1>

  {% if archived_managers %}
    <div class="overflow-x-auto">
      <table class="table w-full border border-gray-300 rounded-xl">
        <thead>
          <tr class="bg-gray-100 text-gray-800 text-sm">
            <th class="py-3 px-4">‚Ññ</th>
            <th class="py-3 px-4">–Ü–º º—è</th>
            <th class="py-3 px-4">TG –Ω—ñ–∫</th>
            <th class="py-3 px-4">–ü–æ—Å–∞–¥–∞</th>
            <th class="py-3 px-4">–í—ñ–¥–¥—ñ–ª</th>
            <th class="py-3 px-4">–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</th>
            <th class="py-3 px-4">–ö-—Å—Ç—å –±–ª–æ–∫—ñ–≤</th>
            <th class="py-3 px-4">–ü—Ä–æ–≥—Ä–µ—Å</th>
            <th class="py-3 px-4">–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody>
          {% for idx, (manager, instance) in enumerate(archived_managers, start=1) %}
          <tr class="hover:bg-gray-50 text-sm">
            <td class="py-2 px-4">{{ idx }}</td>
            <td class="py-2 px-4">{{ manager.full_name }}</td>
            <td class="py-2 px-4">{{ manager.tg_nick }}</td>
            <td class="py-2 px-4">{{ manager.position }}</td>
            <td class="py-2 px-4">{{ manager.department }}</td>
            <td class="py-2 px-4">{{ manager.created_at.strftime('%d.%m.%Y') }}</td>
            <td class="py-2 px-4">
              {% set blocks = instance.structure | length %}
              {% set stage_blocks = instance.structure | selectattr('type', 'equalto', 'stage') | list %}
              {{ stage_blocks|length }}
            </td>
            <td class="py-2 px-4">
              {% set completed = instance.test_progress | selectattr('completed') | list | length %}
              {% set total = instance.structure | selectattr('type', 'equalto', 'stage') | list | length %}
              {{ completed }}/{{ total }}
            </td>
            <td class="py-2 px-4">
              <a href="{{ url_for('main.manager_results', manager_id=manager.id, onboarding_id=instance.id) }}"
                 class="btn btn-sm btn-outline btn-info">
                –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info mt-4">–ù–∞—Ä–∞–∑—ñ –∞—Ä—Ö—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π.</div>
  {% endif %}
</div>
{% endblock %}