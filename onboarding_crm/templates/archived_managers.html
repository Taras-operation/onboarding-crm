{% extends "base.html" %}
{% block title %}üì¶ –ê—Ä—Ö—ñ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">üì¶ –ê—Ä—Ö—ñ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤</h1>
    <a href="{{ url_for('main.managers_list') }}" class="btn btn-sm btn-outline btn-secondary">
      ‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É
    </a>
  </div>

  {% if archived_managers %}
    <div class="overflow-x-auto shadow rounded-lg border border-gray-200">
      <table class="table w-full text-sm">
        <thead class="bg-base-200 text-gray-700">
          <tr>
            <th class="py-3 px-4 text-left">‚Ññ</th>
            <th class="py-3 px-4 text-left">–Ü–º‚Äô—è</th>
            <th class="py-3 px-4 text-left">Telegram</th>
            <th class="py-3 px-4 text-left">–ü–æ—Å–∞–¥–∞</th>
            <th class="py-3 px-4 text-left">–í—ñ–¥–¥—ñ–ª</th>
            <th class="py-3 px-4 text-left">–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</th>
            <th class="py-3 px-4 text-left">–ö-—Å—Ç—å –µ—Ç–∞–ø—ñ–≤</th>
            <th class="py-3 px-4 text-left">–ü—Ä–æ–≥—Ä–µ—Å</th>
            <th class="py-3 px-4 text-left">–§—ñ–¥–±–µ–∫</th>
          </tr>
        </thead>
        <tbody>
          {% for pair in archived_managers %}
            {% set manager = pair[0] %}
            {% set instance = pair[1] %}
            <tr class="hover:bg-base-100">
              <td class="py-2 px-4 font-semibold">{{ loop.index }}</td>
              <td class="py-2 px-4">{{ manager.full_name }}</td>
              <td class="py-2 px-4">@{{ manager.tg_nick }}</td>
              <td class="py-2 px-4">{{ manager.position }}</td>
              <td class="py-2 px-4">{{ manager.department }}</td>
              <td class="py-2 px-4">{{ manager.created_at.strftime('%d.%m.%Y') }}</td>
              <td class="py-2 px-4">
                {% set stages = instance.structure | selectattr('type', 'equalto', 'stage') | list %}
                {{ stages | length }}
              </td>
              <td class="py-2 px-4">
                {% set completed = instance.test_progress | selectattr('completed') | list | length %}
                {% set total = instance.structure | selectattr('type', 'equalto', 'stage') | list | length %}
                {{ completed }}/{{ total }}
              </td>
              <td class="py-2 px-4">
                <a href="{{ url_for('main.manager_results', manager_id=manager.id, onboarding_id=instance.id) }}"
                   class="btn btn-xs btn-outline btn-info">
                  –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-center py-12">
      <p class="text-gray-500 text-lg">–ü–æ–∫–∏ —â–æ –∞—Ä—Ö—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π üóÉÔ∏è</p>
    </div>
  {% endif %}
</div>
{% endblock %}