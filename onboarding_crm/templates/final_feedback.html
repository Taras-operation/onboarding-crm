{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto mt-10 bg-white shadow-md rounded p-6 border border-gray-200">

  <h1 class="text-2xl font-bold text-gray-800 mb-6">üìã –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ñ—ñ–¥–±–µ–∫: {{ manager.full_name or manager.username }}</h1>

  <!-- –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
  <div class="mb-6">
    <p>üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: <strong>{{ manager.full_name or manager.username }}</strong></p>
    <p>üìÖ –°—Ç–∞—Ä—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥—É: {{ instance.created_at.strftime('%d.%m.%Y') }}</p>
    <p>üßë‚Äçüè´ –ú–µ–Ω—Ç–æ—Ä / –¢–õ: {{ current_user.username }}</p>
  </div>

  <!-- –ë–ª–æ–∫ –¢–µ—Å—Ç–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">üß† –¢–µ—Å—Ç–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è</h2>
    <p>‚Äì –£—Å—å–æ–≥–æ –ø–∏—Ç–∞–Ω—å: <strong>{{ test_results|length }}</strong></p>
    <p>‚Äì –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: <strong>{{ test_percent }}%</strong></p>
    <p class="mt-2">üîé –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: 
      {% if test_recommendation == "–ü—Ä–æ–π–¥–µ–Ω–æ" %}
        <span class="text-green-600 font-semibold">‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ</span>
      {% elif test_recommendation == "–ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è" %}
        <span class="text-yellow-600 font-semibold">‚ö†Ô∏è –ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è</span>
      {% else %}
        <span class="text-red-600 font-semibold">‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ</span>
      {% endif %}
    </p>
  </div>

  <!-- –ë–ª–æ–∫ –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">‚úçÔ∏è –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è</h2>
    {% if open_questions %}
      <p>‚Äì –í—Å—å–æ–≥–æ: <strong>{{ open_questions|length }}</strong></p>
      <p>‚Äì –ó–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ: <strong>{{ open_percent }}%</strong></p>

      <div class="mt-4 space-y-4">
        {% for r in open_questions %}
          <div class="p-4 border rounded {% if r.approved is sameas true %}border-green-300 bg-green-50{% elif r.approved is sameas false %}border-red-300 bg-red-50{% else %}border-gray-200{% endif %}">
            <p class="font-medium text-gray-800">‚ùì {{ r.question }}</p>
            <p class="text-sm mt-2">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä –º–µ–Ω—Ç–æ—Ä–∞: <em>{{ r.feedback or "‚Äî" }}</em></p>
            <p class="mt-1">
              –°—Ç–∞—Ç—É—Å: 
              {% if r.approved is sameas true %}
                <span class="text-green-700 font-semibold">–ó–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ</span>
              {% elif r.approved is sameas false %}
                <span class="text-red-700 font-semibold">–ù–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ</span>
              {% else %}
                <span class="text-gray-500 italic">–ù–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ</span>
              {% endif %}
            </p>
          </div>
        {% endfor %}
      </div>

      <p class="mt-4">üîé –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:
        {% if open_recommendation == "–ü—Ä–æ–π–¥–µ–Ω–æ" %}
          <span class="text-green-600 font-semibold">‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ</span>
        {% elif open_recommendation == "–ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è" %}
          <span class="text-yellow-600 font-semibold">‚ö†Ô∏è –ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è</span>
        {% else %}
          <span class="text-red-600 font-semibold">‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ</span>
        {% endif %}
      </p>
    {% else %}
      <p class="text-green-700">‚úÖ –í—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å –Ω–µ –±—É–ª–æ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ</p>
    {% endif %}
  </div>

  <!-- –ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">üèÅ –ü—ñ–¥—Å—É–º–æ–∫</h2>
    <p class="text-lg font-bold">
      {{ final_recommendation }}
    </p>
  </div>

  <!-- –î—ñ—ó -->
  <form action="{{ url_for('main.final_decision') }}" method="POST" class="flex flex-wrap gap-4">
    <input type="hidden" name="instance_id" value="{{ instance.id }}">
    {{ csrf_token() }}
    <button name="decision" value="approved" type="submit"
            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
      ‚úÖ –ó–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
    </button>
    <button name="decision" value="rejected" type="submit"
            class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded">
      ‚ùå –ù–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ
    </button>
    <a href="{{ url_for('main.edit_onboarding', manager_id=manager.id) }}"
            class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded">
      ‚úçÔ∏è –ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
    </a>
  </form>
</div>
{% endblock %}