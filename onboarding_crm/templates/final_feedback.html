<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ñ—ñ–¥–±–µ–∫</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-10 px-4">

  <div class="max-w-5xl mx-auto bg-white shadow-lg rounded-lg p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-4">üìã –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ñ—ñ–¥–±–µ–∫: {{ manager.full_name or manager.username }}</h1>

    <!-- –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
    <div class="mb-6 space-y-1 text-gray-700">
      <p>üë§ <strong>–ú–µ–Ω–µ–¥–∂–µ—Ä:</strong> {{ manager.full_name or manager.username }}</p>
      <p>üìÖ <strong>–°—Ç–∞—Ä—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥—É:</strong> {{ instance.created_at.strftime('%d.%m.%Y') }}</p>
      <p>üßë‚Äçüè´ <strong>–ú–µ–Ω—Ç–æ—Ä / –¢–õ:</strong> {{ current_user.username }}</p>
    </div>

    <!-- –ë–ª–æ–∫ –¢–µ—Å—Ç–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è -->
    <div class="mb-8 bg-blue-50 border border-blue-200 rounded p-6">
      <h2 class="text-xl font-semibold text-blue-700 mb-3">üß† –¢–µ—Å—Ç–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è</h2>
      <p>‚Äì –£—Å—å–æ–≥–æ –ø–∏—Ç–∞–Ω—å: <strong>{{ total_test_questions }}</strong></p>
      <p>‚Äì –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: <strong>{{ correct_test_answers }}/{{ total_test_questions }}</strong></p>
      <p>‚Äì –í—ñ–¥—Å–æ—Ç–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö: <strong>{{ test_percent }}%</strong></p>

      {% if weak_test_blocks %}
        <div class="mt-4">
          <p class="font-medium text-red-600">üìâ –°–ª–∞–±–∫—ñ –±–ª–æ–∫–∏ (–º–µ–Ω—à–µ 60%):</p>
          <ul class="list-disc list-inside text-gray-800">
            {% for b in weak_test_blocks %}
              <li>{{ b.title }} ‚Äî {{ b.percent }}%</li>
            {% endfor %}
          </ul>
        </div>
      {% elif weakest_test_block %}
        <div class="mt-4">
          <p class="font-medium text-yellow-600">üìâ –ù–∞–π–º–µ–Ω—à —É—Å–ø—ñ—à–Ω–∏–π –±–ª–æ–∫:</p>
          <p>{{ weakest_test_block.title }} ‚Äî {{ weakest_test_block.percent }}%</p>
        </div>
      {% endif %}
    </div>

    <!-- –ë–ª–æ–∫ –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è -->
    <div class="mb-8 bg-yellow-50 border border-yellow-200 rounded p-6">
      <h2 class="text-xl font-semibold text-yellow-800 mb-3">‚úçÔ∏è –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è</h2>
      <p>‚Äì –í—Å—å–æ–≥–æ –ø–∏—Ç–∞–Ω—å: <strong>{{ open_questions|length }}</strong></p>
      <p>‚Äì –ó–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ: <strong>{{ open_approved_count }}/{{ open_questions|length }}</strong></p>
      <p>‚Äì –í—ñ–¥—Å–æ—Ç–æ–∫ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–∏—Ö: <strong>{{ open_percent }}%</strong></p>

      {% if weak_open_blocks %}
        <div class="mt-4">
          <p class="font-medium text-red-600">üìâ –ë–ª–æ–∫–∏ –∑ >2 –Ω–µ–∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏:</p>
          <ul class="list-disc list-inside text-gray-800">
            {% for b in weak_open_blocks %}
              <li>{{ b }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <div class="mt-6 space-y-4">
        {% for r in open_questions %}
          <div class="p-4 rounded border
            {% if r.approved is sameas true %} border-green-400 bg-green-50
            {% elif r.approved is sameas false %} border-red-400 bg-red-50
            {% else %} border-gray-300 {% endif %}">
            <p class="text-gray-800 font-medium">‚ùì {{ r.question }}</p>
            <p class="text-sm mt-2">üí¨ <strong>–ö–æ–º–µ–Ω—Ç–∞—Ä –º–µ–Ω—Ç–æ—Ä–∞:</strong> <em>{{ r.feedback or "‚Äî" }}</em></p>
            <p class="mt-1">
              <strong>–°—Ç–∞—Ç—É—Å:</strong>
              {% if r.approved is sameas true %}
                <span class="text-green-700 font-semibold">–ó–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ</span>
              {% elif r.approved is sameas false %}
                <span class="text-red-700 font-semibold">–ù–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ</span>
              {% else %}
                <span class="text-gray-500 italic">–ù–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ</span>
              {% endif %}
            </p>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- –§—ñ–Ω–∞–ª—å–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è -->
    <div class="mb-8 bg-gray-100 border border-gray-300 rounded p-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">üèÅ –ü—ñ–¥—Å—É–º–æ–∫</h2>
      <p class="text-lg font-bold text-gray-800 mb-2">
        {% if final_score >= 71 %}‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ
        {% elif final_score >= 41 %}üü† –ü–æ—Ç—Ä–µ–±—É—î –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
        {% else %}‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ
        {% endif %}
      </p>
      <p class="text-gray-700">–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª (—Ç–µ—Å—Ç–∏ + –≤—ñ–¥–∫—Ä–∏—Ç—ñ): <strong>{{ final_score }}%</strong></p>

      {% if summary_issues %}
        <div class="mt-3">
          <p class="font-semibold text-gray-800">üìå –ü—Ä–æ—Å—ñ–¥–∞–Ω–Ω—è –≤ –±–ª–æ–∫–∞—Ö:</p>
          <ul class="list-disc list-inside text-sm text-gray-700">
            {% for msg in summary_issues %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>

    <!-- –î—ñ—ó -->
    <form action="{{ url_for('main.final_decision') }}" method="POST" class="flex flex-wrap gap-4 mt-6">
      <input type="hidden" name="instance_id" value="{{ instance.id }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <button name="decision" value="approved" type="submit"
              class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
        ‚úÖ –ó–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
      </button>
      <button name="decision" value="rejected" type="submit"
              class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded">
        ‚ùå –ù–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ
      </button>
      <a href="{{ url_for('main.edit_onboarding', manager_id=manager.id) }}"
         class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded">
        ‚úçÔ∏è –ù–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
      </a>
    </form>
  </div>

</body>
</html>